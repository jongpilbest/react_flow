// actions.js
'use server';


// 

async function modal_struction(text_description,Start_number,rootNode){
  const systemPrompt = `
  ë‹¹ì‹ ì€ SQL ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì œê³µí•œ SQL ë¬¸ì¥ì„ ì´ˆë³´ìê°€ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆë„ë¡ **íŠ¸ë¦¬ í˜•íƒœë¡œ ë‹¨ê³„ë³„ ë¶„í•´**í•´ì•¼ í•©ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ë‹¤ìŒ ë¬¸ì¥: ${text_description} ë¥¼ íŠ¸ë¦¬ í˜•íƒœë¡œ ë¶„ì„í•´ë‹¬ë¼ê³  ìš”ì²­í–ˆìŠµë‹ˆë‹¤.
  ì¸ íë¦„ì— ì „ê°œë©ë‹ˆë‹¤"
   
Step 1 (ì›ë˜ í…Œì´ë¸”):

FROM doctors í…Œì´ë¸”ì—ì„œ ëª¨ë“  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. data[3]ì— ì‹¤ì œ ë°ì´í„° ì˜ˆì‹œë¥¼ ì¶”ê°€í•˜ì—¬ ì „ì²´ doctor í…Œì´ë¸” ë°ì´í„°ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

Step 2 (ì„œë¸Œì¿¼ë¦¬ ì‹œì‘):

WHERE SPECIALTY IN (ì„œë¸Œì¿¼ë¦¬)ë¡œ ì„œë¸Œì¿¼ë¦¬ ê²°ê³¼ë¥¼ ë©”ì¸ ì¿¼ë¦¬ì—ì„œ ì‚¬ìš©í•˜ì—¬ í•„í„°ë§í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ department ëŒ€ì‹  SPECIALTY ì»¬ëŸ¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

Step 3 (ì›ë˜ í…Œì´ë¸”):

FROM doctorsì—ì„œ ì›ë˜ í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³ , ì´ ë‹¨ê³„ì—ì„œëŠ” GROUP BY ì ˆì„ ì¶”ê°€í•˜ì—¬ SPECIALTYë³„ë¡œ ì˜ì‚¬ë¥¼ ê·¸ë£¹í™”í•©ë‹ˆë‹¤.

Step 4 (GROUP BY):

SPECIALTYë³„ë¡œ ì˜ì‚¬ë¥¼ ê·¸ë£¹í™”í•˜ê³ , ì˜ì‚¬ ìˆ˜ê°€ 2ëª… ì´ìƒì¸ SPECIALTYë§Œ ì¶”ì¶œí•˜ëŠ” HAVING ì¡°ê±´ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

Step 5 (HAVING):

HAVING COUNT(*) >= 2ë¡œ ì˜ì‚¬ ìˆ˜ê°€ 2ëª… ì´ìƒì¸ SPECIALTYë§Œ ì„ íƒí•©ë‹ˆë‹¤.

Step 6 (ì„œë¸Œì¿¼ë¦¬ ìµœì¢… SELECT ë¬¸):

SELECT SPECIALTY FROM doctors GROUP BY SPECIALTY HAVING COUNT(*) >= 2ë¡œ ìµœì¢…ì ìœ¼ë¡œ SPECIALTYê°€ 2ëª… ì´ìƒì¸ ê°’ë§Œ ì„ íƒë©ë‹ˆë‹¤.

Step 7 (ìµœì¢… SELECT ë¬¸):

SELECT DR_NAME, SPECIALTY FROM doctors WHERE SPECIALTY IN (ì„œë¸Œì¿¼ë¦¬)ë¡œ ìµœì¢…ì ìœ¼ë¡œ ì˜ì‚¬ ì´ë¦„ê³¼ ì§„ë£Œê³¼ë¥¼ ë°˜í™˜í•˜ê³ , SPECIALTYë³„ë¡œ ì •ë ¬ëœ ê²°ê³¼ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.


ê·œì¹™
- ì„œë¸Œì¿¼ë¦¬ë¥¼ í¬í•¨í•˜ëŠ” ë…¸ë“œëŠ” ë°˜ë“œì‹œ **childrenì„ 2ê°œ í¬í•¨**í•´ì•¼ í•©ë‹ˆë‹¤:
    1. ì„œë¸Œì¿¼ë¦¬ íë¦„ì˜ ì‹œì‘ ë…¸ë“œ (ì˜ˆ: Step 2-1)
    2. ì„œë¸Œì¿¼ë¦¬ ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ë©”ì¸ íë¦„ ë…¸ë“œ (ì˜ˆ: Step 3)
  - ì´ë ‡ê²Œ í•˜ë©´ íŠ¸ë¦¬ê°€ ëª…í™•í•˜ê²Œ ë¶„ê¸°ë˜ê³ , ì„œë¸Œì¿¼ë¦¬ íë¦„ê³¼ ë©”ì¸ íë¦„ì´ êµ¬ë¶„ë©ë‹ˆë‹¤

   - ì„œë¸Œì¿¼ë¦¬ë€:
   - SELECT ë¬¸ ì•ˆì— í¬í•¨ëœ ë˜ ë‹¤ë¥¸ SELECT ë¬¸ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
   - ì˜ˆ: WHERE dept_id IN (SELECT dept_id FROM departments WHERE ...) â†’ ê´„í˜¸ ì•ˆì˜ SELECTê°€ ì„œë¸Œì¿¼ë¦¬ì…ë‹ˆë‹¤.
   - ë‹¤ìŒê³¼ ê°™ì€ ìœ„ì¹˜ì—ì„œ ìì£¼ ë“±ì¥í•©ë‹ˆë‹¤:
     - WHERE ì ˆ
     - FROM ì ˆ (ì¸ë¼ì¸ ë·°)
     - SELECT ì ˆ (ìŠ¤ì¹¼ë¼ ì„œë¸Œì¿¼ë¦¬)
    - ì´ì™€ ê°™ì€ ì¤‘ì²©ëœ SELECT ë¬¸ì„ ë°˜ë“œì‹œ ì°¾ì•„ë‚´ì–´, ë‚´ë¶€ ì„œë¸Œì¿¼ë¦¬ë„ ê¼­  ğŸ“Œ - WHERE, GROUP BY, HAVING, ORDER BY  ğŸ“Œ  ë“±ì˜ ì ˆ ë‹¨ìœ„ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤.
    - ì„œë¸Œì¿¼ë¦¬ì˜ ìµœì¢…ê²°ê³¼ëŠ” ê¼­ ì¶œë ¥í•´ì£¼ì„¸ìš”
    
   ğŸ“ ì‘ì„± ê·œì¹™:
  - ì²« ë…¸ë“œì˜ idëŠ” ë°˜ë“œì‹œ ${Start_number}ë¡œ ì‹œì‘í•˜ë©°, ì´í›„ëŠ” 1ì”© ì¦ê°€ì‹œí‚µë‹ˆë‹¤.
  - ì „ì²´ SQL ë¬¸ì€ ë°˜ë“œì‹œ **ë§ˆì§€ë§‰ ë…¸ë“œì—ì„œë§Œ ì¶œë ¥**ë˜ì–´ì•¼ í•˜ë©°, ì¤‘ê°„ ë‹¨ê³„ì—ì„œëŠ” ì „ì²´ SQL ë˜ëŠ” ì¤‘ê°„ ê²°ê³¼ë¥¼ ì¶œë ¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  - ì¤‘ë³µë˜ê±°ë‚˜ ë¶ˆí•„ìš”í•œ ë…¸ë“œëŠ” ìƒì„±í•˜ì§€ ë§ˆì„¸ìš”.

  ğŸ“˜ êµ¬ì„± ê·œì¹™:
  - ê° ë…¸ë“œëŠ” ë‹¤ìŒ í•„ë“œë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:
    - id: "3", "4" ë“± ë¬¸ìì—´ ID
    - name: "Step 2-1" ë“± ë‹¨ê³„ ì´ë¦„
    - type: "Child"
    - children: ë‹¤ìŒ ë…¸ë“œ ID ë°°ì—´
    - data: [SQL ì¡°ê°, ì„¤ëª…, " ë¶€ëª¨ì—ì„œ ì¶”ê°€ëœ + sql ë¬¸ë²• ]
     ğŸ“˜ ì˜ˆì‹œ êµ¬ì„± ê·œì¹™ :
     ğŸ“Œ -  ê¼­ì§€ì¼œì£¼ì„¸ìš”!!!!!! ğŸ“Œ
  data[0] ê°€       "FROM DOCTOR",
 ì¼ë•Œë‚˜ data[1] ì„œë¸Œì¿¼ë¦¬ì—ì„œ DOCTOR í…Œì´ë¸”ì„ ê°€ì ¸ì˜µë‹ˆë‹¤ì¼ë•ŒëŠ”  data[3] ì€
   ["DR_NAME", "DR_ID", "LCNS_NO", "TLNO", "SPECIALTY", "PHONE"] ìœ ì§€í•´ì•¼ë©ë‹ˆë‹¤!!!
  [ 
  [
  ["DR_NAME", "DR_ID", "LCNS_NO", "TLNO", "SPECIALTY", "PHONE"],
  [
    ["ë£¨í”¼", "DR20090029", "LC00010001", "2009-03-01", "CS", "01085482011"],
    ["íŒ¨í‹°", "DR20090001", "LC00010901", "2009-07-01", "CS", "01085220122"],
    ["ë½€ë¡œë¡œ", "DR20170123", "LC00091201", "2017-03-01", "GS", "01034969210"],
    ["í‹°ê±°", "DR20100011", "LC00011201", "2010-03-01", "NP", "01034229818"],
    ["í’ˆë°”", "DR20090231", "LC00011302", "2015-11-01", "OS", "01049840278"],
    ["í‹°ëª¬", "DR20090112", "LC00011162", "2010-03-01", "FM", "01094622190"]

    /// ì¶”ê°€ê°€ëŠ¥ í•˜ê²Œ ë§Œë“¤ì–´ì„œ ë¶€ëª¨ > ìì‹ ê´€ì˜ ê´€ê³„ë¥¼ ë” ì˜ ë³´ì—¬ì¤˜ë„ ë©ë‹ˆë‹¤. 
            
  ["í’ˆë°”", "DR20090231", "LC00011302", "2015-11-01", "OS", "01049840278", "2014-03-01"],
  ["í‹°ëª¬", "DR20090112", "LC00011162", "2010-03-01", "FM", "01094622190", "2012-12-01"]
  
]
]
]

          
     - ê° ë…¸ë“œì˜ data[3]ì—ëŠ” í•´ë‹¹ ë‹¨ê³„ì—ì„œ  *ê·¸ì— ë”°ë¥¸ ê²°ê³¼ì˜ ë³€í™”**ë¥¼ ëª…í™•í•˜ê²Œ í¬í•¨í•©ë‹ˆë‹¤.
       
     - ì˜ˆë¥¼ ë“¤ì–´, WHERE ì ˆì„ ì¶”ê°€í•˜ëŠ” ë‹¨ê³„ì—ì„œëŠ” ì´ì „ ê²°ê³¼ì—ì„œ ì–´ë–¤ ë°ì´í„°ê°€ í•„í„°ë§ë˜ëŠ”ì§€ ëª…ì‹œì ìœ¼ë¡œ ë³´ì—¬ì¤˜ì•¼ í•©ë‹ˆë‹¤.
     ğŸ“Œ- !!!(ê¼­ ì§€ì¼œì£¼ì„¸ìš”) ê° ì ˆì˜ data[3]ì—ëŠ” "ë¶€ëª¨ê²°ê³¼" â†’ "ìì‹ ê²°ê³¼"ì˜ íë¦„ìœ¼ë¡œ ìµœì¢… ê²°ê³¼ ë³€í™”ê°€ ë³´ì´ê²Œ ì ë‹¹í•œ ì˜ˆì‹œë¥¼ ì œê³µí•´ì£¼ì„¸ìš”  ğŸ“Œ
       - doctors í…Œì´ë¸”ì€ ì»¬ëŸ¼ êµ¬ì¡°ëŠ” ìœ ì§€í•˜ì§€ë§Œ, ë°ì´í„° í–‰ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì„ ëª…ì‹œí•©ë‹ˆë‹¤. 
         [ 
         [
  ["DR_NAME", "DR_ID", "LCNS_NO", "TLNO", "SPECIALTY", "PHONE"],
  [
    ["ë£¨í”¼", "DR20090029", "LC00010001", "2009-03-01", "CS", "01085482011"],
    ["íŒ¨í‹°", "DR20090001", "LC00010901", "2009-07-01", "CS", "01085220122"],
    ["ë½€ë¡œë¡œ", "DR20170123", "LC00091201", "2017-03-01", "GS", "01034969210"],
    ["í‹°ê±°", "DR20100011", "LC00011201", "2010-03-01", "NP", "01034229818"],
    ["í’ˆë°”", "DR20090231", "LC00011302", "2015-11-01", "OS", "01049840278"],
    ["í‹°ëª¬", "DR20090112", "LC00011162", "2010-03-01", "FM", "01094622190"]

    /// ì¶”ê°€ê°€ëŠ¥ í•˜ê²Œ ë§Œë“¤ì–´ì„œ ë¶€ëª¨ > ìì‹ ê´€ì˜ ê´€ê³„ë¥¼ ë” ì˜ ë³´ì—¬ì¤˜ë„ ë©ë‹ˆë‹¤. 
            
  ["í’ˆë°”", "DR20090231", "LC00011302", "2015-11-01", "OS", "01049840278", "2014-03-01"],
  ["í‹°ëª¬", "DR20090112", "LC00011162", "2010-03-01", "FM", "01094622190", "2012-12-01"]
  
]
]
  
         
    


   
      

ì‹¤í—˜ ì˜ˆì‹œ 

{
  "2": {
    "id": "2",
    "name": "Step 1: ì›ë˜ í…Œì´ë¸”",
    "type": "Child",
    "children": ["3"],
    "data": [
      "FROM doctors",
      "doctors í…Œì´ë¸”ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.",
      "+ WHERE",
        //     - FROM doctors ì ˆì—ì„œ ì „ì²´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤ëŠ” ì˜ë¯¸ëŠ” í…Œì´ë¸”ì˜ ëª¨ë“  ì»¬ëŸ¼ 5ê°œë¥¼ ë³´ì—¬ì¤˜ì•¼ í•œë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.
      [
      [ 
    ["DR_NAME", "DR_ID", "LCNS_NO", "TLNO", "SPECIALTY", "PHONE"],
    [
      ["ë£¨í”¼", "DR20090029", "LC00010001", "2009-03-01", "CS", "01085482011"],
      ["íŒ¨í‹°", "DR20090001", "LC00010901", "2009-07-01", "CS", "01085220122"],
      ["ë½€ë¡œë¡œ", "DR20170123", "LC00091201", "2017-03-01", "GS", "01034969210"],
      ["í‹°ê±°", "DR20100011", "LC00011201", "2010-03-01", "NP", "01034229818"],
      ["í’ˆë°”", "DR20090231", "LC00011302", "2015-11-01", "OS", "01049840278"],
      ["í‹°ëª¬", "DR20090112", "LC00011162", "2010-03-01", "FM", "01094622190"]
    ]
  ]
]
     



    
  },
  "3": {
    "id": "3",
    "name": "Step 2: ì„œë¸Œì¿¼ë¦¬ ì‹œì‘",
    "type": "Child",
    "children": ["4", "8"],
    "data": [
      "WHERE SPECIALTY IN (ì„œë¸Œì¿¼ë¦¬)",
      "SPECIALTYê°€ ì„œë¸Œì¿¼ë¦¬ ê²°ê³¼ì— í¬í•¨ëœ ì§„ë£Œê³¼ë§Œ í•„í„°ë§í•©ë‹ˆë‹¤.",
      "+ ì„œë¸Œì¿¼ë¦¬ í•„ìš” â†’ ì•„ë˜ ë‹¨ê³„ì—ì„œ ì „ê°œë©ë‹ˆë‹¤"
    ]
  },
  "4": {
    "id": "4",
    "name": "Step 3: ì›ë˜ í…Œì´ë¸” (FROM doctors)",
    "type": "Child",
    "children": ["6"],
    "data": [
      "FROM doctors",
      "doctors í…Œì´ë¸”ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.",
      "+ GROUP BY ì¶”ê°€",
      //     - FROM doctors ì ˆì—ì„œ ì „ì²´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤ëŠ” ì˜ë¯¸ëŠ” í…Œì´ë¸”ì˜ ëª¨ë“  ì»¬ëŸ¼ 5ê°œë¥¼ ë³´ì—¬ì¤˜ì•¼ í•œë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.  
      [
      [ 
    ["DR_NAME", "DR_ID", "LCNS_NO", "TLNO", "SPECIALTY", "PHONE"],
    [
      ["ë£¨í”¼", "DR20090029", "LC00010001", "2009-03-01", "CS", "01085482011"],
      ["íŒ¨í‹°", "DR20090001", "LC00010901", "2009-07-01", "CS", "01085220122"],
      ["ë½€ë¡œë¡œ", "DR20170123", "LC00091201", "2017-03-01", "GS", "01034969210"],
      ["í‹°ê±°", "DR20100011", "LC00011201", "2010-03-01", "NP", "01034229818"],
      ["í’ˆë°”", "DR20090231", "LC00011302", "2015-11-01", "OS", "01049840278"],
      ["í‹°ëª¬", "DR20090112", "LC00011162", "2010-03-01", "FM", "01094622190"]
    ]
  ]
    ]
  },
  "5": {
    "id": "5",
    "name": "Step 4: GROUP BY SPECIALTY",
    "type": "Child",
    "children": ["6"],
    "data": [
      "GROUP BY SPECIALTY",
      "SPECIALTYë³„ë¡œ ì˜ì‚¬ë“¤ì„ ê·¸ë£¹í™”í•©ë‹ˆë‹¤.",
      "+ HAVING ì¶”ê°€",
      [
        [
          ["SPECIALTY", "COUNT(*)"],
          [
            ["CS", 2],
            ["GS", 1],
            ["NP", 1],
            ["OS", 1],
            ["FM", 1]
          ]
        ]
      ]
    ]
  },
  "6": {
    "id": "6",
    "name": "Step 5: HAVING COUNT(*) >= 2",
    "type": "Child",
    "children": ["7"],
    "data": [
      "HAVING COUNT(*) >= 2",
      "ì˜ì‚¬ ìˆ˜ê°€ 2ëª… ì´ìƒì¸ SPECIALTYë§Œ ì¶”ì¶œí•©ë‹ˆë‹¤.",
      "+ SELECT ì¶”ê°€",
      [
        [
          ["SPECIALTY", "COUNT(*)"],
          [
            ["CS", 2]
          ]
        ]
      ]
    ]
  },
  "7": {
    "id": "7",
    "name": "Step 6: ì„œë¸Œì¿¼ë¦¬ ìµœì¢… SELECT ë¬¸",
    "type": "Child",
    "children": ["8"],
    "data": [
      "SELECT SPECIALTY FROM doctors GROUP BY SPECIALTY HAVING COUNT(*) >= 2",
      "ì„œë¸Œì¿¼ë¦¬ì—ì„œ SPECIALTY ì»¬ëŸ¼ë§Œ ì„ íƒí•˜ê³ , ì˜ì‚¬ ìˆ˜ê°€ 2ëª… ì´ìƒì¸ SPECIALTYë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.",
      "+ ì„œë¸Œì¿¼ë¦¬ ê²°ê³¼ ë°˜ì˜",
      [
        [
          ["CS"],
          [
            ["CS"]
          ]
        ]
      ]
    ]
  },
  "8": {
    "id": "8",
    "name": "Step 7: ìµœì¢… SELECT ë¬¸ìœ¼ë¡œ ì˜ì‚¬ ì •ë³´ ì¶”ì¶œ",
    "type": "Child",
    "children": [],
    "data": [
      "SELECT DR_NAME, SPECIALTY FROM doctors WHERE SPECIALTY IN (ì„œë¸Œì¿¼ë¦¬) ORDER BY SPECIALTY",
      "ì˜ì‚¬ ì´ë¦„(DR_NAME)ê³¼ ì§„ë£Œê³¼(SPECIALTY)ë¥¼ ë°˜í™˜í•˜ë©°, SPECIALTYë³„ë¡œ ì •ë ¬ëœ ê²°ê³¼ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.",
      "",
      [
        [
          ["DR_NAME", "SPECIALTY"],
          [
            ["ë£¨í”¼", "CS"],
            ["íŒ¨í‹°", "CS"]
          ]
        ]
      ]
    ]
  }
}


ì˜ˆì‹œ2
{
  "2": {
    "id": "2",
    "name": "Step 1: ì›ë˜ í…Œì´ë¸”",
    "type": "Child",
    "children": ["3"],
    "data": [
      "FROM DOCTOR",
      "DOCTOR í…Œì´ë¸”ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.",
      "+ WHERE",
      [
        [
          ["DR_NAME", "DR_ID", "LCNS_NO", "HIRE_YMD", "MCDP_CD", "TLNO"],
          [
            ["ë£¨í”¼", "DR20090029", "LC00010001", "2009-03-01", "CS", "01085482011"],
            ["íŒ¨í‹°", "DR20090001", "LC00010901", "2009-07-01", "CS", "01085220122"],
            ["ë½€ë¡œë¡œ", "DR20170123", "LC00091201", "2017-03-01", "GS", "01034969210"],
            ["í‹°ê±°", "DR20100011", "LC00011201", "2010-03-01", "NP", "01034229818"],
            ["í’ˆë°”", "DR20090231", "LC00011302", "2015-11-01", "OS", "01049840278"],
            ["í‹°ëª¬", "DR20090112", "LC00011162", "2010-03-01", "FM", "01094622190"]
          ]
        ]
      ]
    ]
  },
  "3": {
    "id": "3",
    "name": "Step 2: ì„œë¸Œì¿¼ë¦¬ ì‹œì‘",
    "type": "Child",
    "children": ["4", "6"],
    "data": [
      "WHERE HIRE_YMD = (ì„œë¸Œì¿¼ë¦¬)",
      "HIRE_YMDê°€ ì„œë¸Œì¿¼ë¦¬ ê²°ê³¼ì™€ ë™ì¼í•œ ì˜ì‚¬ë§Œ í•„í„°ë§í•©ë‹ˆë‹¤.",
      "+ ì„œë¸Œì¿¼ë¦¬ í•„ìš” â†’ ì•„ë˜ ë‹¨ê³„ì—ì„œ ì „ê°œë©ë‹ˆë‹¤"
    ]
  },
  "4": {
    "id": "4",
    "name": "Step 3: ì„œë¸Œì¿¼ë¦¬ FROM ì ˆ",
    "type": "Child",
    "children": ["5"],
    "data": [
      "FROM DOCTOR",
      "ì„œë¸Œì¿¼ë¦¬ì—ì„œ DOCTOR í…Œì´ë¸”ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.",
      "+ MIN í•¨ìˆ˜ ì‚¬ìš©",
      [
        [
          ["DR_NAME", "DR_ID", "LCNS_NO", "HIRE_YMD", "MCDP_CD", "TLNO"],
          [
            ["ë£¨í”¼", "DR20090029", "LC00010001", "2009-03-01", "CS", "01085482011"],
            ["íŒ¨í‹°", "DR20090001", "LC00010901", "2009-07-01", "CS", "01085220122"],
            ["ë½€ë¡œë¡œ", "DR20170123", "LC00091201", "2017-03-01", "GS", "01034969210"],
            ["í‹°ê±°", "DR20100011", "LC00011201", "2010-03-01", "NP", "01034229818"],
            ["í’ˆë°”", "DR20090231", "LC00011302", "2015-11-01", "OS", "01049840278"],
            ["í‹°ëª¬", "DR20090112", "LC00011162", "2010-03-01", "FM", "01094622190"]
          ]
        ]
      ]
    ]
  },
  "5": {
    "id": "5",
    "name": "Step 4: ì„œë¸Œì¿¼ë¦¬ MIN í•¨ìˆ˜",
    "type": "Child",
    "children": ["6"],
    "data": [
      "SELECT MIN(HIRE_YMD) FROM DOCTOR",
      "ê°€ì¥ ì˜¤ë˜ëœ HIRE_YMDë¥¼ ì„ íƒí•©ë‹ˆë‹¤.",
      "+ ì„œë¸Œì¿¼ë¦¬ ê²°ê³¼ ë°˜ì˜",
      [
        [
          ["MIN(HIRE_YMD)"],
          [
            ["2009-03-01"]
          ]
        ]
      ]
    ]
  },
  "6": {
    "id": "6",
    "name": "Step 5: ìµœì¢… SELECT ë¬¸ìœ¼ë¡œ ì˜ì‚¬ ì •ë³´ ì¶”ì¶œ",
    "type": "Child",
    "children": [],
    "data": [
      "SELECT DR_NAME, DR_ID, LCNS_NO, HIRE_YMD, MCDP_CD, TLNO FROM DOCTOR WHERE HIRE_YMD = (SELECT MIN(HIRE_YMD) FROM DOCTOR)",
      "ê°€ì¥ ì˜¤ë˜ ê·¼ë¬´í•œ ì˜ì‚¬ì™€ ë™ì¼í•œ ê³ ìš©ì¼ìë¥¼ ê°€ì§„ ëª¨ë“  ì˜ì‚¬ì˜ ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.",
      "",
      [
        [
          ["DR_NAME", "DR_ID", "LCNS_NO", "HIRE_YMD", "MCDP_CD", "TLNO"],
          [
            ["ë£¨í”¼", "DR20090029", "LC00010001", "2009-03-01", "CS", "01085482011"]
          ]
        ]
      ]
    ]
  }
}


  ğŸ“¤ ì¶œë ¥ ê·œì¹™:
  - ì¶œë ¥ì€ ì„¤ëª… ì—†ì´ **JSON ê°ì²´**ë§Œ ë°˜í™˜í•©ë‹ˆë‹¤ (ì½”ë“œ ë¸”ë¡ ì‚¬ìš© ê¸ˆì§€).
  - ê° data í•„ë“œëŠ” [SQL ì¡°ê°, ì„¤ëª…, "+ ì–´ë–¤ ì ˆì´ ì¶”ê°€ë˜ì—ˆëŠ”ì§€"] í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.
   


  `;
  
const response = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${process.env.OPENAI_API_KEY}`,
    },
    body: JSON.stringify({
      model: "gpt-4o",
      messages: [
        { role: "system", content: "ë‹¹ì‹ ì€ SQL ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ìì—°ì–´ ìš”ì²­ì— ëŒ€í•´ ì •í™•í•œ nySQLì„ ìƒì„±í•˜ì„¸ìš”. ë°ì´í„°ëŠ” ë‹¤ìŒì€ ì¢…í•©ë³‘ì›ì— ì†í•œ ì˜ì‚¬ ì •ë³´ë¥¼ ë‹´ì€ DOCTOR í…Œì´ë¸”ì…ë‹ˆë‹¤. DOCTOR í…Œì´ë¸”ì€ ë‹¤ìŒê³¼ ê°™ìœ¼ë©° DR_NAME, DR_ID, LCNS_NO, HIRE_YMD, MCDP_CD, TLNOëŠ” ê°ê° ì˜ì‚¬ì´ë¦„, ì˜ì‚¬ID, ë©´í—ˆë²ˆí˜¸, ê³ ìš©ì¼ì, ì§„ë£Œê³¼ì½”ë“œ, ì „í™”ë²ˆí˜¸ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì„¤ëª…ì€ ì œì™¸í•˜ê³  sql ë§Œ ë§Œë“¤ì–´ì£¼ì„¸ìš” "  },
        { role: "user", content: text_description }
      ],
      temperature: 0.1,
    }),
  });
  
  const dataResponse = await response.json();

  const sqlQuery = dataResponse.choices[0].message.content

  const response2 = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${process.env.OPENAI_API_KEY}`,
    },
    body: JSON.stringify({
      model: "gpt-4o",
      messages: [
        { role: "system", content: systemPrompt },  // ì•ì—ì„œ ë§Œë“  íŠ¸ë¦¬ ë¶„ì„ìš© í”„ë¡¬í”„íŠ¸
        { role: "user", content: sqlQuery }
      ],
      temperature: 0,
    }),
  });
  const dataResponse2 = await response2.json();

  const sqlQuery2 = dataResponse2.choices[0].message.content


  return sqlQuery2




}
  

export async function Flow_chat(formData) {
  const productId = formData.get("productId");
  const numbers=  formData.get("numbers")
  
 // console.log("ì„œë²„ì—ì„œ ë°›ì€ productId:", productId);
 // // ì—¬ê¸°ì— DB ì €ì¥, ë¡œì§ ì²˜ë¦¬ ë“± ê°€ëŠ¥
 // console.log("ì„œë²„ì—ì„œ ë°›ì€ productId:", numbers);

  
  const response= await modal_struction(productId,numbers)

   return response

}